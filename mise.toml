[tools]
# Outils indispensables au Cockpit
gum = "latest"      # UI Interactif
fzf = "latest"      # Recherche floue
bat = "latest"      # Cat avec syntax highlight
hk = "latest"       # Git Hooks manager
pkl = "latest"      # Config language pour hk
#nh = "latest"       # Nix Helper (Speed up builds & GC)
stylua = "latest"   # Formatter Lua (Neovim)
shfmt = "latest"    # Formatter Bash

[tasks.install]
description = "Bootstrap initial post-clone"
run = """
#!/usr/bin/env bash
# 1. Installe les hooks git
if command -v hk >/dev/null; then hk install; fi
# 2. Applique la config Nix initiale
./scripts/cockpit.sh --apply-only
"""

[tasks.ui]
description = "ğŸ–¥ï¸  Ouvre le Cockpit Principal"
alias = "cockpit"
run = "./scripts/cockpit.sh"

[tasks.switch]
description = "ğŸ”„ Applique la config Nix (Rebuild)"
run = "nh os switch ." # nh dÃ©tecte auto si c'est Darwin ou NixOS

[tasks.stow]
description = "ğŸ”— Applique les dotfiles (Symlinks)"
run = "./scripts/stow-apply.sh"

[tasks.save]
description = "â˜ï¸  Snapshot : Git Add + Commit + Push"
run = """
#!/usr/bin/env bash
git add .
MSG=$(gum input --placeholder "Message de commit...")
if [ -z "$MSG" ]; then echo "Commit cancelled"; exit 1; fi
git commit -m "$MSG"
git push
"""

[tasks.gc]
description = "ğŸ§¹ Nettoyage du Store Nix"
run = "nh clean all --keep 3" # Garde les 3 derniÃ¨res gÃ©nÃ©rations

[tasks.test-mac]
description = "ğŸ§ª Lance une VM Tart et teste l'installation complÃ¨te"
depends = ["install"]
run = "./scripts/ci/test-darwin.sh"
