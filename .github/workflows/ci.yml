name: Nix Flake CI

on:
  push:
    branches: [main, jules-*]
  pull_request:


  # ========================================
  # JOB: Build Configurations
  # ========================================
  build-configs:
    name: "ðŸ”¨ Build ${{ matrix.name }}"
    runs-on: ${{ matrix.os }}
    needs: validate
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: "Linux Test"
            config: nixosConfigurations.test-linux.config.system.build.toplevel
            os: ubuntu-latest
            is-darwin: false
    steps:
      # Checkout + NIX (+cache)
      - uses: actions/checkout@v4
      - name: Build Configuration
        run: |
          echo "ðŸ”¨ Building ${{ matrix.name }}..."
          export CI=true;
          ./bootstrap.sh
    