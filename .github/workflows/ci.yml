name: Nix Flake CI

on:
  push:
    branches: [main, jules-*]
  pull_request:

jobs:
  build-configs:
    name: "ðŸ”¨ Build ${{ matrix.name }}"
    runs-on: ${{ matrix.os }}
    # needs: validate # Ã€ dÃ©commenter si vous avez un job nommÃ© validate
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: "Linux Test"
            config: nixosConfigurations.test-linux.config.system.build.toplevel
            os: ubuntu-latest
            is-darwin: false
            
    steps:
      - uses: actions/checkout@v4

      # Note : bootstrap.sh installe Nix, mais dans GitHub Actions, 
      # les changements de PATH ne survivent pas toujours entre les Ã©tapes 
      # ou au sein d'un mÃªme script complexe.
      - name: Run Bootstrap
        run: |
          echo "ðŸ”¨ Building ${{ matrix.name }}..."
          export CI=true
          chmod +x ./bootstrap.sh ./i.sh
          ./bootstrap.sh
        shell: bash